% Copyright 2007 by Till Tantau
% Copyright 2015 by Vedran Mileti\'c, Joseph Wright
% Copyright 2018 by Carlos Veiga Rodrigues
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Public License.

\newif\ifbeamer@sb@showbullets
\DeclareOptionBeamer{showbullets}[true]{\csname beamer@sb@showbullets#1\endcsname}
\ExecuteOptionsBeamer{showbullets=true}

\newif\ifbeamer@sb@subsection
\DeclareOptionBeamer{subsection}[true]{\csname beamer@sb@subsection#1\endcsname}
\ExecuteOptionsBeamer{subsection=true}

\ProcessOptionsBeamer


\mode<presentation>

\setbeamercolor{frametitle}{parent=palette primary}
\setbeamercolor{subsection in head/foot}{parent=palette secondary}
\setbeamercolor{section in head/foot}{parent=palette quaternary}


\beamer@compresstrue

\AtBeginDocument{
  {
    \usebeamerfont*{headline}
    \colorlet{global.bg}{bg}
    \usebeamercolor{subsection in head/foot}
    \usebeamercolor{section in head/foot}
    \usebeamercolor{frametitle}
  }
}

%% Head
\defbeamertemplate*{headline}{tocbar theme}
{%
  \ifbeamer@sb@showbullets%
    \begin{beamercolorbox}[dp=3.75ex]{section in head/foot}
      \insertnavigation{\paperwidth}
    \end{beamercolorbox}%
  \else
    \begin{beamercolorbox}[dp=1.25ex]{section in head/foot}
      \insertnavigation{\paperwidth}
    \end{beamercolorbox}%
  \fi%
  \ifbeamer@sb@subsection%
    \begin{beamercolorbox}[ht=2.125ex,dp=1.125ex,%
      leftskip=.3cm,rightskip=.3cm plus1fil]{subsection in head/foot}
      \usebeamerfont{subsection in head/foot}\insertsubsectionhead
    \end{beamercolorbox}%
  \fi%
}%


\defbeamertemplate*{frametitle}{tocbar theme}
{%
  \nointerlineskip%
  \usebeamerfont{headline}%
  \vskip-.5ex%
  \nointerlineskip%
  \begin{beamercolorbox}[wd=\paperwidth,leftskip=.3cm,rightskip=.3cm plus1fil,vmode]{frametitle}
    \usebeamerfont*{frametitle}\insertframetitle%
      \ifx\insertframesubtitle\@empty%
        \strut\par%
      \else
        \par{\usebeamerfont*{framesubtitle}{\usebeamercolor[fg]{framesubtitle}\insertframesubtitle}\strut\par}%
      \fi%%
    \usebeamerfont{headline}%
    \vskip.5ex  
  \end{beamercolorbox}%
  \nointerlineskip
}
  
  
\mode<all>
